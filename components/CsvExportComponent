import React, { useEffect } from "react";

export default function CsvExportComponent({
  apiEndpoint,
  requestData,
  filename,
}) {
  useEffect(() => {
    // Fetch data from the API
    fetch(apiEndpoint, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(requestData),
    })
      .then((response) => response.json())
      .then((data) => {
        // Generate CSV and initiate download
        generateAndDownloadCsv(data, filename);
      })
      .catch((error) => {
        console.error("Error fetching data:", error);
      });
  }, [apiEndpoint, requestData, filename]);

  const generateAndDownloadCsv = (data, filename) => {
    const generateCsv = (data) => {
      const headers = Object.keys(data[0]);
      const csv = [
        headers.join(","),
        ...data.map((obj) => headers.map((key) => obj[key]).join(",")),
      ];
      return csv.join("\n");
    };

    const csvContent = generateCsv(data);
    const blob = new Blob([csvContent], { type: "text/csv" });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename || "data.csv";
    a.click();
    window.URL.revokeObjectURL(url);
  };

  return null;
}
